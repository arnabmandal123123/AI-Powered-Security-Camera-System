<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32-CAM Security System - Human Detection</title>
    <link rel="stylesheet" href="style.css">
    <!-- TensorFlow.js for AI Human Detection -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>üîí ESP32-CAM Security System</h1>
            <p class="subtitle">AI-Powered Human Detection & Alarm System</p>
            <div class="connection-status" id="connectionStatus">
                <span id="statusDot" class="status-dot offline"></span>
                <span id="statusText">Disconnected</span>
            </div>
        </header>

        <!-- Security Status Bar -->
        <section class="security-status-bar" id="securityStatusBar">
            <div class="security-status-item">
                <span class="status-icon">üö®</span>
                <div class="status-info">
                    <span class="status-label">Alarm Status</span>
                    <span class="status-value" id="alarmStatus">DISARMED</span>
                </div>
            </div>
            <div class="security-status-item">
                <span class="status-icon">üë§</span>
                <div class="status-info">
                    <span class="status-label">Detection</span>
                    <span class="status-value" id="detectionStatus">Monitoring...</span>
                </div>
            </div>
            <div class="security-status-item">
                <span class="status-icon">‚ö°</span>
                <div class="status-info">
                    <span class="status-label">Events Today</span>
                    <span class="status-value" id="eventsCount">0</span>
                </div>
            </div>
        </section>

        <!-- Alert Banner -->
        <div class="alert-banner" id="alertBanner" style="display: none;">
            <div class="alert-content">
                <span class="alert-icon">‚ö†Ô∏è</span>
                <span class="alert-text" id="alertText"></span>
                <button class="alert-close" onclick="closeAlertBanner()">‚úï</button>
            </div>
        </div>

        <!-- Configuration Panel -->
        <section class="config-panel">
            <h2>‚öôÔ∏è System Configuration</h2>
            <div class="config-form">
                <label for="cameraIP">ESP32-CAM IP Address:</label>
                <input type="text" id="cameraIP" placeholder="192.168.1.45" value="192.168.1.45">
                <button id="connectCamBtn" class="btn btn-success">Connect Camera</button>
                
                <label for="detectionSensitivity">Detection Sensitivity:</label>
                <select id="detectionSensitivity">
                    <option value="0.5">High (50%)</option>
                    <option value="0.6" selected>Medium (60%)</option>
                    <option value="0.7">Low (70%)</option>
                </select>
            </div>
        </section>

        <!-- Main Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Camera Feed Section -->
            <section class="card camera-section">
                <h2>üìπ Live Security Feed</h2>
                <div class="camera-container">
                    <canvas id="detectionCanvas" style="display:none;"></canvas>
                    <img id="cameraFeed" alt="Camera feed" style="width:100%; display:block;">
                    <div class="camera-overlay" id="cameraOverlay">
                        <p>Camera not connected</p>
                        <p class="overlay-hint">Enter IP and click Connect Camera</p>
                    </div>
                </div>
                <div class="camera-controls">
                    <button id="streamBtn" class="btn btn-primary">‚ñ∂Ô∏è Start Stream</button>
                    <button id="captureBtn" class="btn btn-secondary">üì∑ Capture</button>
                    <button id="toggleDetectionBtn" class="btn btn-success">ü§ñ Enable AI Detection</button>
                    <button id="toggleAlarmBtn" class="btn btn-danger">üö® Arm Alarm</button>
                </div>
                
                <div class="alert-settings">
                    <h3 style="margin: 15px 0 10px 0; font-size: 1em; color: #ecf0f1;">‚ö†Ô∏è Alert Triggers</h3>
                    <p style="margin: 0 0 10px 0; font-size: 0.85em; color: #95a5a6;">Select objects that will trigger the alarm:</p>
                    <div class="alert-objects">
                        <label class="object-checkbox">
                            <input type="checkbox" value="person" checked>
                            <span>üë§ Person</span>
                        </label>
                        <label class="object-checkbox">
                            <input type="checkbox" value="dog">
                            <span>üêï Dog</span>
                        </label>
                        <label class="object-checkbox">
                            <input type="checkbox" value="cat">
                            <span>üêà Cat</span>
                        </label>
                        <label class="object-checkbox">
                            <input type="checkbox" value="car">
                            <span>üöó Car</span>
                        </label>
                        <label class="object-checkbox">
                            <input type="checkbox" value="truck">
                            <span>üöö Truck</span>
                        </label>
                        <label class="object-checkbox">
                            <input type="checkbox" value="bicycle">
                            <span>üö≤ Bicycle</span>
                        </label>
                        <label class="object-checkbox">
                            <input type="checkbox" value="motorcycle">
                            <span>üèçÔ∏è Motorcycle</span>
                        </label>
                        <label class="object-checkbox">
                            <input type="checkbox" value="backpack">
                            <span>üéí Backpack</span>
                        </label>
                        <label class="object-checkbox">
                            <input type="checkbox" value="cell phone">
                            <span>üì± Phone</span>
                        </label>
                        <label class="object-checkbox">
                            <input type="checkbox" value="laptop">
                            <span>üíª Laptop</span>
                        </label>
                        <label class="object-checkbox">
                            <input type="checkbox" value="tv">
                            <span>üì∫ TV</span>
                        </label>
                    </div>
                </div>
                
                <div class="detection-stats">
                    <div class="stat-item">
                        <span class="stat-label">FPS:</span>
                        <span class="stat-value" id="fpsDisplay">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">AI Status:</span>
                        <span class="stat-value" id="aiStatus">Loading...</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Detected:</span>
                        <span class="stat-value" id="detectedObjects">None</span>
                    </div>
                </div>
            </section>

            <!-- Security Events Log -->
            <section class="card">
                <h2>üìã Security Events Log</h2>
                <div class="events-log" id="eventsLog">
                    <p class="log-entry info">System initialized. Waiting for events...</p>
                </div>
                <button id="clearEventsBtn" class="btn btn-secondary">Clear Events</button>
            </section>

            <!-- Detection History -->
            <section class="card">
                <h2>üìä Detection Statistics</h2>
                <div class="sensor-grid">
                    <div class="sensor-item">
                        <span class="sensor-label">Total Detections</span>
                        <span class="sensor-value" id="totalDetections">0</span>
                    </div>
                    <div class="sensor-item">
                        <span class="sensor-label">Last Detection</span>
                        <span class="sensor-value" id="lastDetection">Never</span>
                    </div>
                    <div class="sensor-item">
                        <span class="sensor-label">Alarm Triggers</span>
                        <span class="sensor-value" id="alarmTriggers">0</span>
                    </div>
                    <div class="sensor-item">
                        <span class="sensor-label">System Uptime</span>
                        <span class="sensor-value" id="systemUptime">0s</span>
                    </div>
                </div>
            </section>

            <!-- Captured Snapshots -->
            <section class="card full-width">
                <h2>üì∏ Captured Snapshots</h2>
                <div class="snapshots-container" id="snapshotsContainer">
                    <p class="placeholder-text">No snapshots yet. Snapshots are automatically captured when humans are detected.</p>
                </div>
            </section>

            <!-- System Info Section -->
            <section class="card">
                <h2>üìä System Information</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Camera Status:</span>
                        <span class="info-value" id="cameraStatus">Disconnected</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">AI Model:</span>
                        <span class="info-value" id="aiModelStatus">Loading...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Last Update:</span>
                        <span class="info-value" id="lastUpdate">Never</span>
                    </div>
                </div>
            </section>
        </div>

        <!-- Alarm Sound (Hidden) -->
        <audio id="alarmSound" loop>
            <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGGe76+eeUwwMUKbu8bRlGggzk9jyz3orBSV+yO/ekk0IEVms6OyrWA8LR6Pg8blkGgY+mdzvyHUpBSB5xu7dlEcIDlOo5O63YRoHNo7W8s92LgUldMXu3JFBCBJaquXurWEUCzye0/HJeSsFInTF8NuRSAcNV6rm8bJhFwo4mtjxzHgpBR92xO7Yk0cIDFOs5e23YRoGNJHX8styLAUndsTu25BHCAhWqOTtsmEaCzSP1vLMeSoFJXPD79yQRwgMV6vk7bNeFws0kdvwynkpBR92yO/bkUgHDViu5e+0YRUKNJXb8s96KAUieMnv25JJBgtYruTvtmEUCTCR2u/MdysEInLG8NySRwYNWbDk77ZeFQozjdXzzHgqBCJ0xe/ckEYHC1is5PG4YBQJMpLZ8M14KAQgdMnv3JFGBw1ZsuTvumAUCjGO1vDNdysEIHLH8NyRRwcLWK7j8bliEwkyj9nwzXYpBCFzyO7bk0cGDVmw5PC2YBQJMo3W8ct3KgUkdcnu3JJHCA1YruPxtmETCTGO2PDLdysEInLG8NySRwcMWK7k8LhgFAkyj9nwy3YpBSF0yO7ck0gGDVmu4/C2YRMIMpHY8Mt2KgQhc8bv3JJHBwtXruTvuGATCDGQ2fDKdikEInLG79yRSAYNWK7k77VhEwkxj9nwy3UqBCJzxu/ckUcHDFiv5PC4YRMJMI/Z8Mp2KQUgc8jv25FHBw1YruTvuGATCDKP2fDLdioEIHPG79uSRwcMV67k8LdgFAkxj9nwyn0pBSBzxu/bkkgGDlmu5O+2YRMJMpDY8Mp2KQQhc8Xv25FHBw1ZruTvuGATCDCO2PDKdSoFInLG8NuRSAYNWa7k77ZgEwkxj9nwynUpBCJzxu/bkkgGDVmu5PG4YBMJMY/Y8Mt1KgQhc8bu25FHBw1YruTvt2ATCTGMgAA" type="audio/wav">
        </audio>
    </div>

    <script src="script.js?v=2"></script>
</body>
</html>
            </section>

            <!-- Security Section -->
            <section class="card">
                <h2>üîí Advanced Security</h2>
                <div class="sensor-grid">
                    <div class="sensor-item">
                        <span class="sensor-label">PIR Motion</span>
                        <span class="sensor-status" id="pirStatus">None</span>
                    </div>
                    
                    <div class="sensor-item">
                        <span class="sensor-label">Distance</span>
                        <span class="sensor-value" id="distance">-- cm</span>
                    </div>
                    
                    <div class="sensor-item alert-box" id="intrusionAlert" style="display: none;">
                        <span class="alert-icon">‚ö†Ô∏è</span>
                        <span class="alert-text">INTRUSION DETECTED!</span>
                    </div>
                </div>
            </section>

            <!-- Camera Feed Section -->
            <section class="card camera-section">
                <h2>üì∑ Camera Feed</h2>
                <div class="camera-container">
                    <img id="cameraFeed" src="" alt="Camera feed will appear here">
                    <div class="camera-overlay" id="cameraOverlay">
                        <p>Camera not connected</p>
                    </div>
                </div>
                <div class="camera-controls">
                    <button id="captureBtn" class="btn btn-secondary">Capture Image</button>
                    <button id="streamBtn" class="btn btn-secondary">Toggle Stream</button>
                </div>
            </section>

            <!-- System Info Section -->
            <section class="card">
                <h2>üìä System Information</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Last Update:</span>
                        <span class="info-value" id="lastUpdate">Never</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Data Rate:</span>
                        <span class="info-value" id="dataRate">0 updates/min</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Uptime:</span>
                        <span class="info-value" id="uptime">0s</span>
                    </div>
                </div>
            </section>

            <!-- Serial Monitor Section -->
            <section class="card full-width">
                <h2>üìü Serial Monitor</h2>
                <div class="serial-monitor" id="serialMonitor">
                    <p class="log-entry">Waiting for connection...</p>
                </div>
                <button id="clearLogBtn" class="btn btn-secondary">Clear Log</button>
            </section>
        </div>
    </div>
</body>
</html>
